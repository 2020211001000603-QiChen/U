# 数据路径问题排查指南

## 错误信息

```
FileNotFoundError: [Errno 2] No such file or directory: 'Datasets/MIntRec/train.tsv'
```

## 问题原因

代码会查找以下路径：
```
{data_path}/{dataset}/train.tsv
```

例如：
- `data_path = 'Datasets'`
- `dataset = 'MIntRec'`
- 完整路径 = `Datasets/MIntRec/train.tsv`

---

## 解决方案

### 方案1：检查数据文件是否存在（推荐）

#### 步骤1：确认数据文件位置

```bash
# Linux/Mac
ls -la Datasets/MIntRec/
# 应该看到：
# train.tsv
# dev.tsv
# test.tsv
# video_data/
# audio_data/

# Windows PowerShell
Get-ChildItem Datasets\MIntRec\
```

#### 步骤2：确认数据目录结构

正确的目录结构应该是：

```
Datasets/
└── MIntRec/
    ├── train.tsv
    ├── dev.tsv
    ├── test.tsv
    ├── video_data/
    │   └── swin_feats.pkl
    └── audio_data/
        └── wavlm_feats.pkl
```

#### 步骤3：如果文件不存在，需要下载或准备数据

参考 README.md 中的数据集准备说明。

---

### 方案2：使用绝对路径

如果数据文件在其他位置，使用绝对路径：

```bash
# Linux/Mac
python run.py \
    --dataset MIntRec \
    --data_path /path/to/your/Datasets \
    --train \
    --save_model \
    --gpu_id '0'

# Windows
python run.py \
    --dataset MIntRec \
    --data_path "D:\path\to\your\Datasets" \
    --train \
    --save_model \
    --gpu_id '0'
```

---

### 方案3：修改脚本中的 data_path

修改 `examples/run_umc.sh` 中的 `--data_path` 参数：

```bash
# 修改前
--data_path 'Datasets' \

# 修改后（使用绝对路径）
--data_path '/root/autodl-tmp/UMC/Datasets' \

# 或者（使用相对路径，但需要确保在正确的工作目录）
--data_path './Datasets' \
```

---

### 方案4：检查当前工作目录

确认运行脚本时的工作目录是否正确：

```bash
# 在运行脚本前，先检查当前目录
pwd  # Linux/Mac
cd   # Windows

# 确保在项目根目录（UMC-main 目录）
# 然后运行
python run.py --dataset MIntRec --data_path 'Datasets' ...
```

---

### 方案5：使用相对路径（从项目根目录）

如果数据在项目目录下：

```bash
# 确保在 UMC-main 目录下运行
cd /path/to/UMC-main

# 使用相对路径
python run.py \
    --dataset MIntRec \
    --data_path './Datasets' \
    --train \
    --save_model \
    --gpu_id '0'
```

---

## 快速检查脚本

创建一个检查脚本来验证数据路径：

```bash
#!/bin/bash
# check_data.sh

DATASET=$1
DATA_PATH=$2

if [ -z "$DATASET" ]; then
    DATASET="MIntRec"
fi

if [ -z "$DATA_PATH" ]; then
    DATA_PATH="Datasets"
fi

FULL_PATH="$DATA_PATH/$DATASET"

echo "检查数据路径: $FULL_PATH"
echo ""

if [ ! -d "$FULL_PATH" ]; then
    echo "❌ 目录不存在: $FULL_PATH"
    exit 1
fi

echo "✅ 目录存在: $FULL_PATH"
echo ""

# 检查必需文件
REQUIRED_FILES=("train.tsv" "dev.tsv" "test.tsv")
MISSING_FILES=()

for file in "${REQUIRED_FILES[@]}"; do
    if [ ! -f "$FULL_PATH/$file" ]; then
        MISSING_FILES+=("$file")
        echo "❌ 文件缺失: $file"
    else
        echo "✅ 文件存在: $file"
    fi
done

echo ""
if [ ${#MISSING_FILES[@]} -eq 0 ]; then
    echo "✅ 所有必需文件都存在！"
    exit 0
else
    echo "❌ 缺少以下文件:"
    for file in "${MISSING_FILES[@]}"; do
        echo "   - $file"
    done
    exit 1
fi
```

使用方法：
```bash
chmod +x check_data.sh
./check_data.sh MIntRec Datasets
```

---

## 针对您的具体情况

根据错误信息，您使用的是 `Datasets/MIntRec/`，但文件不存在。

### 检查步骤：

1. **确认数据文件位置**：
```bash
# 在服务器上检查
ls -la Datasets/MIntRec/
# 或者
find . -name "train.tsv" -type f
```

2. **如果数据在其他位置**，修改脚本：

```bash
# 修改 examples/run_umc.sh
--data_path '/root/autodl-tmp/UMC/Datasets' \  # 使用实际路径
```

3. **如果使用 MELD-DA 数据集**：

```bash
# 修改脚本中的数据集名称和路径
--dataset MELD-DA \
--data_path '/path/to/your/Datasets' \
--config_file_name umc_MELD-DA \
```

---

## 常见问题

### Q1: 相对路径 vs 绝对路径

**相对路径**：从当前工作目录开始
- `Datasets/MIntRec` - 当前目录下的 Datasets/MIntRec
- 需要确保在正确的目录运行脚本

**绝对路径**：完整路径
- `/root/autodl-tmp/UMC/Datasets/MIntRec` - 绝对路径
- 不依赖当前目录

**推荐**：使用绝对路径，更可靠

### Q2: 路径大小写问题

Linux 系统区分大小写：
- `MIntRec` ≠ `mintrec` ≠ `MINTREC`

确保数据集名称与目录名称完全一致。

### Q3: 路径中的空格

如果路径包含空格，需要用引号：

```bash
--data_path '/path with spaces/Datasets' \
```

### Q4: Windows vs Linux 路径

**Windows**：
```bash
--data_path "D:\Datasets"
```

**Linux/Mac**：
```bash
--data_path "/root/Datasets"
```

---

## 修改脚本示例

### 修改 run_umc.sh 使用绝对路径

```bash
#!/usr/bin/bash

# 设置数据路径（根据实际情况修改）
DATA_PATH="/root/autodl-tmp/UMC/Datasets"  # ← 修改这里

for seed in 0 1 2 3 4
do
    echo "运行种子: $seed"
    
    python run.py \
    --dataset MIntRec \
    --data_path "$DATA_PATH" \  # ← 使用变量
    --train \
    --save_model \
    --save_results \
    --seed $seed \
    --gpu_id '0' \
    --config_file_name umc_MIntRec
done
```

### 或者使用环境变量

```bash
#!/usr/bin/bash

# 从环境变量读取，如果没有则使用默认值
DATA_PATH=${UMC_DATA_PATH:-"Datasets"}

python run.py \
    --dataset MIntRec \
    --data_path "$DATA_PATH" \
    --train \
    --save_model \
    --gpu_id '0'
```

运行时：
```bash
export UMC_DATA_PATH="/root/autodl-tmp/UMC/Datasets"
./run_umc.sh
```

---

## 验证修复

修复后，运行前可以先测试：

```bash
# 测试路径是否正确
python -c "
import os
data_path = 'Datasets'
dataset = 'MIntRec'
full_path = os.path.join(data_path, dataset, 'train.tsv')
print(f'查找文件: {full_path}')
print(f'文件存在: {os.path.exists(full_path)}')
if os.path.exists(full_path):
    print(f'文件大小: {os.path.getsize(full_path)} bytes')
"
```

---

## 总结

1. **检查数据文件是否存在**：确认 `Datasets/MIntRec/train.tsv` 等文件存在
2. **使用绝对路径**：更可靠，不依赖当前目录
3. **检查工作目录**：确保在正确的目录运行脚本
4. **验证数据集名称**：确保大小写匹配
5. **检查权限**：确保有读取文件的权限

如果数据文件确实不存在，需要先下载或准备数据集。

