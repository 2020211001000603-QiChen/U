# IEMOCAP-DA 优化方案总结

## 一、诊断发现的关键问题

### 1. ⚠️ **类别严重不平衡**（最严重）

- **不平衡度**: 869.00（非常严重！）
- **最少类别**: 2个样本（DA）
- **最多类别**: 1738个样本（s）
- **影响**: 模型可能偏向多数类，少数类难以学习

### 2. ⚠️ **文本信息量不足**

- **平均长度**: 11.48 tokens
- **中位数**: 8 tokens
- **配置长度**: 44 tokens
- **覆盖率**: 98.81%（但平均长度远小于配置）
- **影响**: 文本特征可能不够丰富，难以学习有效表示

### 3. ⚠️ **超参数设置不当**

- **学习率过高**: 5e-4 vs MELD-DA的2e-4
- **监督温度过低**: 10 vs MELD-DA的20
- **影响**: 训练可能不稳定，学习过于保守

---

## 二、已应用的优化

### 1. **降低学习率** ✅

```python
'lr': [2e-4],  # 从5e-4降低到2e-4
```

**理由**：
- 提高训练稳定性
- 与MELD-DA保持一致
- 避免梯度更新过大

### 2. **提高监督温度** ✅

```python
'train_temperature_sup': [20],  # 从10提高到20
```

**理由**：
- 学习更平滑的分布
- 避免过于自信的预测
- 与MELD-DA保持一致

### 3. **增加模型容量** ✅

```python
'base_dim': [256],  # 从128增加到256
```

**理由**：
- 文本信息量少，需要更大的模型容量
- 增强特征表示能力
- 补偿信息不足的问题

### 4. **调整阈值策略** ✅

```python
'thres': [0.05],   # 从0.1降低到0.05
'delta': [0.02],    # 从0.05降低到0.02
```

**理由**：
- 针对类别不平衡，使用更保守的策略
- 更慢的阈值增长，给模型更多时间学习
- 更低的初始阈值，更早开始选择高置信度样本

### 5. **增强聚类损失权重** ✅

```python
'clustering_weight': 1.5,        # 从1.0增加到1.5
'compactness_weight': 1.2,      # 从1.0增加到1.2
'separation_weight': 1.2,       # 从1.0增加到1.2
```

**理由**：
- 针对类别不平衡，强化聚类约束
- 增强类内紧密度和类间分离度
- 帮助模型更好地区分不同类别

---

## 三、优化效果预期

### 预期改进

| 优化项 | 预期效果 | 风险 |
|--------|---------|------|
| 降低学习率 | 训练更稳定，收敛更好 | 训练可能稍慢 |
| 提高温度 | 学习更平滑的分布 | 可能略微降低区分度 |
| 增加base_dim | 更强的特征表示 | 内存占用增加 |
| 调整阈值 | 更保守的聚类策略 | 收敛可能稍慢 |
| 增强损失权重 | 更好的聚类效果 | 可能过拟合 |

### 综合预期

- **训练稳定性**: 显著提升 ✅
- **聚类性能**: 预期提升 5-15% ✅
- **类别平衡**: 通过损失权重和阈值策略改善 ✅
- **特征质量**: 通过增加base_dim提升 ✅

---

## 四、进一步优化建议

### 如果效果仍不理想，可以尝试：

#### 1. **类别权重平衡**

```python
# 在损失函数中使用类别权重
class_weights = compute_class_weights(label_distribution)
criterion = CrossEntropyLoss(weight=class_weights)
```

#### 2. **数据增强**

- 对少数类进行过采样
- 对多数类进行欠采样
- 使用SMOTE等合成少数类样本

#### 3. **焦点损失（Focal Loss）**

```python
# 使用焦点损失处理类别不平衡
'use_focal_loss': True,
'focal_alpha': 0.25,
'focal_gamma': 2.0,
```

#### 4. **分层采样**

```python
# 在数据加载时使用分层采样
sampler = StratifiedSampler(dataset, labels)
```

#### 5. **集成方法**

- 训练多个模型，使用投票或平均
- 对不同类别使用不同的模型

---

## 五、监控指标

### 训练过程中需要关注：

1. **损失曲线**
   - 是否平稳下降？
   - 是否有震荡？

2. **各类别性能**
   - 少数类的准确率
   - 多数类的准确率
   - 整体平衡性

3. **聚类指标**
   - NMI、ARI、ACC
   - 各类别的聚类质量

4. **特征质量**
   - 类内距离 vs 类间距离
   - Silhouette Score

---

## 六、实验计划

### 阶段1：基础优化（当前）

- ✅ 降低学习率到2e-4
- ✅ 提高温度到20
- ✅ 增加base_dim到256
- ✅ 调整阈值策略
- ✅ 增强损失权重

### 阶段2：如果效果仍不理想

- 尝试类别权重
- 尝试焦点损失
- 尝试数据增强

### 阶段3：高级优化

- 集成方法
- 多阶段训练
- 自适应采样

---

## 七、对比实验建议

### 实验1：当前优化配置

```bash
python run.py \
    --dataset IEMOCAP-DA \
    --config_file_name umc_IEMOCAP-DA \
    --train \
    --save_model \
    --save_results \
    --seed 0
```

### 实验2：进一步增加base_dim

```python
'base_dim': [512],  # 如果256还不够
```

### 实验3：使用类别权重

需要修改损失函数代码，添加类别权重支持。

---

## 八、关键发现总结

### 诊断结果

1. **类别不平衡度**: 869.00（非常严重）
2. **文本平均长度**: 11.48 tokens（信息量不足）
3. **超参数**: 学习率过高，温度过低

### 已应用的优化

1. ✅ 学习率: 5e-4 → 2e-4
2. ✅ 监督温度: 10 → 20
3. ✅ base_dim: 128 → 256
4. ✅ 阈值策略: 更保守
5. ✅ 损失权重: 增强聚类约束

### 预期效果

- 训练稳定性提升
- 聚类性能提升 5-15%
- 类别不平衡问题得到缓解

---

## 九、下一步行动

1. **运行优化后的配置**，观察效果
2. **监控训练过程**，记录关键指标
3. **对比优化前后**的性能差异
4. **如果效果仍不理想**，尝试进一步的优化方案

配置文件已更新，可以直接运行实验！

